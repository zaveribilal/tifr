<!DOCTYPE html>
<html>

<head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Roboto" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="./css/materialize.min.css" media="screen,projection" />
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        #prof_pic{
			width: 140px;
			height: 150px;
			border: 1px solid #424242;
		}

		.logo{
            width: 100px;
            margin: 8px 0px;
        }

        .mandatory{
            color: crimson;
        }

        ::-webkit-file-upload-button {
            text-decoration: none;
            color: #fff;
            background-color: #03a9f4 !important;
            text-align: center;
            letter-spacing: .5px;
            -webkit-transition: background-color .2s ease-out;
            transition: background-color .2s ease-out;
            cursor: pointer;
            border: none;
            border-radius: 2px;
            display: inline-block;
            height: 36px;
            line-height: 36px;
            padding: 0 16px;
            text-transform: uppercase;
            vertical-align: middle;
            -webkit-tap-highlight-color: transparent;
            -webkit-box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12), 0 1px 5px 0 rgba(0, 0, 0, 0.2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.12), 0 1px 5px 0 rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body>
    <nav class="transparent z-depth-0">
        <div class="nav-wrapper container">
            <a href="#" class="brand-logo"><img class="logo" src="images/logo.png" /></a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a class="grey-text text-darken-4" href="new.html">Add Employee</a></li>\
                <li><a class="grey-text text-darken-4" href="search.html">Search Employee</a></li>
                <li><a class="grey-text text-darken-4" href="phone.html">Assign Phone</a></li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <div class="row">
            <h2>Update Employee Detail</h2>
            <div class="row ">
                <div class="col l12 m12 s12 ">
                    <div class="input-field">
                        <label for="Name">Search CCODE</label>
                        <input placeholder="Enter the ccode" id="s_ccode" type="text">
                        <button id="ccode_search" class="waves-effect waves-light btn light-blue">Submit</button>
                    </div>
                </div>
            </div>
            <form action="include/update.php" method="POST" enctype="multipart/form-data">
                <div class="img-holder col l12 m12 s12 center">
                    <p id="chooser_ph">Choose a picture <span class="mandatory">*</span></p>
                    <div class="row">
                        <img id="prof_pic" alt="Profile Pic" />
                    </div>
                    <input id="chooser" type="file" name="prof_pic" required>
                </div>
                <div class="col l6 m12 s12">
                    <div class="input-field">
                        <label for="surname">Surname <span class="mandatory">*</span></label>
                        <input id="surname" type="text" name="surname" id="surname" placeholder="Surname" required>
                    </div>
                    <div class="input-field">
                        <label for="restname">Restname <span class="mandatory">*</span></label>
                        <input id="restname" type="text" name="restname" id="restname" placeholder="Restname" required>
                    </div>
                    <div class="input-field">
                        <label for="ccode">CCODE <span class="mandatory">*</span></label>
                        <input id="ccode" type="text" name="ccode" placeholder="CCODE" required>
                    </div>
                    <div class="input-field">
                        <label for="email">Email <span class="mandatory">*</span></label>
                        <input id="email" type="email" name="email" placeholder="Email" required>
                    </div>
                    <div class="input-field">
                        <label for="dept">Department <span class="mandatory">*</span></label>
                        <input id="dept" type="text" name="dept" placeholder="Department" required>
                    </div>
                    <div class="input-field">
                        <label for="designation">Designation <span class="mandatory">*</span></label>
                        <input id="designation" type="text" name="designation" placeholder="Designation" required>
                    </div>
                    <div class="input-field">
                        <label for="expiry">Expiry <span class="mandatory">*</span></label>
                        <input id="expiry" type="text" name="expiry" placeholder="Expiry" class="datepicker" required>
                    </div>
                    <div class="input-field">
                        <label for="role">Role</label>
                        <input id="role" type="text" name="role" placeholder="Role">
                    </div>
                    <div class="input-field">
                        <label for="off_mob">Official Mobile</label>
                        <input id="off_mob" type="text" name="off_mob" placeholder="Official Mobile">
                    </div>
                    <div class="input-field">
                        <label for="mobile">Mobile</label>
                        <input id="mobile" type="text" name="mobile" placeholder="Mobile">
                    </div>
                    <div class="input-field">
                        <label for="dob">Date of Birth</label>
                        <input id="dob" type="text" name="dob" placeholder="Date of Birth" class="datepicker">
                    </div>
                    <div class="input-field">
                        <label for="room_no">Room No</label>
                        <input id="room_no" type="text" name="room_no" placeholder="Room No">
                    </div>
                    <div class="input-field">
                        <label for="office">Office</label>
                        <input id="office" type="text" name="office" placeholder="Office">
                    </div>
                    <div class="input-field">
                        <label for="residence">Residence</label>
                        <input id="residence" type="text" name="residence" placeholder="Residence">
                    </div>
                    <div class="input-field">
                        <label for="off_1">Off 1</label>
                        <input id="off_1" type="text" name="off_1" placeholder="Off 1">
                    </div>
                    <div class="input-field">
                        <label for="fax">FAX</label>
                        <input id="fax" type="text" name="fax" placeholder="FAX">
                    </div>
                    <div class="input-field">
                        <label for="off_res_ext">Off Res Ext</label>
                        <input id="off_res_ext" type="text" name="off_res_ext" placeholder="Off Res Ext">
                    </div>
                    <div class="input-field">
                        <label for="off_2">Off 2</label>
                        <input id="off_2" type="text" name="off_2" placeholder="Off 2">
                    </div>
                    <div class="input-field">
                        <label for="identity">Identity</label>
                        <input id="identity" type="text" name="identity" placeholder="Identity">
                    </div>
                </div>
                <div class="col l6">
                    <div class="input-field">
                        <label for="project">Project</label>
                        <input id="project" type="text" name="project" placeholder="project">
                    </div>
                    <div class="input-field">
                        <label for="sup_email">Sup Email</label>
                        <input id="sup_email" type="email" name="sup_email" placeholder="Sup Email">
                    </div>
                    <div class="input-field">
                        <label for="homepage">Homepage</label>
                        <input id="homepage" type="text" name="homepage" placeholder="Homepage">
                    </div>
                    <div class="input-field">
                        <label for="street">Street</label>
                        <input id="street" type="text" name="street" placeholder="Street">
                    </div>
                    <div class="input-field">
                        <label for="city">City</label>
                        <input id="city" type="text" name="city" placeholder="City">
                    </div>
                    <div class="input-field">
                        <label for="pincode">Pincode</label>
                        <input id="pincode" type="text" name="pincode" placeholder="Pincode">
                    </div>
                    <div class="input-field">
                        <label for="keyphrase_1">Keyphrase 1</label>
                        <input id="keyphrase_1" type="text" name="keyphrase_1" placeholder="Keyphrase 1">
                    </div>
                    <div class="input-field">
                        <label for="keyphrase_2">Keyphrase 2</label>
                        <input id="keyphrase_2" type="text" name="keyphrase_2" placeholder="Keyphrase 2">
                    </div>
                    <div class="input-field">
                        <label for="keyphrase_3">Keyphrase 3</label>
                        <input id="keyphrase_3" type="text" name="keyphrase_3" placeholder="Keyphrase 3">
                    </div>
                    <div class="input-field">
                        <label for="telid">Tel Id</label>
                        <input id="telid" type="text" name="telid" placeholder="Tel Id">
                    </div>
                    <div class="input-field">
                        <label for="photo_disp">Photo Display</label>
                        <input id="photo_disp" type="text" name="photo_disp" placeholder="Photo Display">
                    </div>
                    <div class="input-field">
                        <label for="design_code">Design Code</label>
                        <input id="design_code" type="text" name="design_code" placeholder="Design Code">
                    </div>
                    <div class="input-field">
                        <label for="metadata">Metadata</label>
                        <input id="metadata" type="text" name="metadata" placeholder="Metadata">
                    </div>
                    <div class="input-field">
                        <label for="pvt_email">Private Email</label>
                        <input id="pvt_email" type="email" name="pvt_email" placeholder="Private Email">
                    </div>
                    <div class="input-field">
                        <label for="mh_id">MH Id</label>
                        <input id="mh_id" type="text" name="mh_id" placeholder="MH Id">
                    </div>
                    <div class="input-field">
                        <label for="role_email">Role Email</label>
                        <input id="role_email" type="email" name="role_email" placeholder="Role Email">
                    </div>
                    <div class="input-field">
                        <label for="title">Title</label>
                        <input id="title" type="text" name="title" placeholder="Title">
                    </div>
                    <div class="input-field">
                        <label for="gender">Gender</label>
                        <input id="gender" type="text" name="gender" placeholder="Gender">
                    </div>
                    <div class="input-field">
                        <label for="extended_expiry">Extended Expiry</label>
                        <input id="extended_expiry" type="text" name="extended_expiry" placeholder="Extended Expiry">
                    </div>
                </div>
                <input class="btn light-blue" type="submit" name="add" value="UPDATE EMPLOYEE">
            </form>
        </div>
    </div>

    <!--JavaScript at end of body for optimized loading-->
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="./js/materialize.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (getCookie('PHPSESSID') === "") {
                window.location.href = "unauth.html";
            }

            var url = new URL(window.location.href);
            var status = url.searchParams.get("status");

            if (status === 'Success') {
                M.toast({ html: "Employee Updated!" });
            } else if (status === 'Failed') {
                M.toast({ html: "Failed to update Employee!" });
            }

            var elems = document.querySelectorAll('.datepicker');
            var instances = M.Datepicker.init(elems, {});

            var search_btn = document.getElementById('ccode_search');
            var ccode = document.getElementById('s_ccode')
            search_btn.addEventListener('click', function () {
                var formData = new FormData();
                formData.append("ccode", ccode.value);
                var ajax = new XMLHttpRequest();
                ajax.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        console.log(this.responseText);
                        var response = JSON.parse(this.responseText);
                        console.log(response.data);
                        document.getElementById('prof_pic').src = response.data['photo'];
                        delete response.data["photo"];
                        for (var i in response.data) {
                            console.log(i);
                            document.getElementById(i).value = response.data[i];
                        }
                    }
                }
                ajax.open("POST", "include/search_update.php", true);
                ajax.send(formData);
            });

            function handleFileSelect(evt) {
                if (evt.target.files != null) {
                    var file = evt.target.files;
                }
                if (file) {
                    var f = file[0];
                    var reader = new FileReader();
                    reader.onload = (function (theFile) {
                        return function (e) {
                            document.getElementById('prof_pic').src = e.target.result;
                            document.getElementById('prof_pic').style.boxShadow = "0 2px 2px 0 rgba(0,0,0,0.2)";
                        };
                    })(f);
                    reader.readAsDataURL(f);
                }
            }
            document.getElementById('chooser').addEventListener('change', handleFileSelect);
        });

        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }
    </script>
</body>

</html>23w